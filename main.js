(()=>{"use strict";class e{constructor(){}addField(e){const t=document.createElement("div");t.classList.add("field_block");const s=document.createElement("div");s.classList.add("field_box_users");const n=document.createElement("ul");n.classList.add("list_users"),s.append(n);const a=document.createElement("div");a.classList.add("field_box_messenge");const i=document.createElement("div");i.classList.add("block_messeng"),a.append(i);const d=document.createElement("div");d.classList.add("mess");const o=document.createElement("input");o.type="text",o.classList.add("mess_text"),d.append(o);const c=document.createElement("button");c.classList.add("mess_btn"),c.textContent="Отправить",d.append(c),a.append(d),t.append(s),t.append(a),e.append(t)}addItemListUsers(e,t,s){const n=document.createElement("li");e===s?(n.classList.add("item_user_you"),n.textContent="YOU"):(n.classList.add("item_user"),n.textContent=`${e}`),t.append(n)}addMessenge(e,t,s,n,a){const i=document.createElement("div"),d=document.createElement("p");s===n?(i.classList.add("item_mess_you"),d.textContent=`YOU, ${a}`):(i.classList.add("item_mess"),d.textContent=`${s}, ${a}`),d.classList.add("name_and_data");const o=document.createElement("p");o.classList.add("item_text"),o.textContent=`${t}`,i.append(d),i.append(o),e.append(i)}}(new class{constructor(){this.page=document.querySelector("#root"),this.field=new e,this.websocket=null,this.youName=void 0,this.allUsers=void 0,this.messenges=void 0}init(){this.add(this.page)}add(e){const t=document.createElement("div");t.classList.add("block_entry");const s=document.createElement("h2");s.classList.add("block_entry_title"),s.textContent="Выберите псевдоним";const n=document.createElement("p");n.classList.add("error_mess"),n.textContent="выберите другое имя, такой есть)))";const a=document.createElement("input");a.type="text",a.classList.add("block_entry_input");const i=document.createElement("button");i.classList.add("block_entry_btn"),i.textContent="Продолжить",t.append(s),t.append(n),t.append(a),t.append(i),e.append(t),i.addEventListener("click",(e=>{e.preventDefault(),this.youName=a.value,this.nameChack(a.value)}))}nameChack(e){if(!e.trim())return;const t={name:e.trim()};fetch("https://chat-back-96ra.onrender.com/new-user",{method:"POST",body:JSON.stringify(t)}).then((t=>{200===t.status&&(this.clearPage(this.page),this.field.addField(this.page),this.users=this.page.querySelector(".list_users"),this.field.addItemListUsers(e.trim(),this.users,this.youName),this.loadingPage(),this.messengeItem()),t.status;this.page.querySelector(".error_mess").classList.add("error_mess_activ")})),window.addEventListener("unload",(()=>{this.websocket.send(JSON.stringify({msg:"вышел",type:"exit",user:this.youName}))}))}loadingPage(){this.websocket=new WebSocket("https://chat-back-96ra.onrender.com"),this.websocket.addEventListener("open",(e=>{console.log(e)})),this.websocket.addEventListener("close",(e=>{console.log(e)})),this.websocket.addEventListener("error",(e=>{console.log(e)})),this.websocket.addEventListener("message",(e=>{if(this.allUsers=JSON.parse(e.data),console.log(this.allUsers),"send"!=this.allUsers.type){const e=this.page.querySelector(".list_users");this.clearPage(e);for(const e of this.allUsers)this.field.addItemListUsers(e.name,this.users,this.youName)}else{if(this.allUsers.user==this.youName)return;this.field.addMessenge(this.pageMess,this.allUsers.message,this.allUsers.user,this.youName,this.time())}}))}messengeItem(){this.pageMess=this.page.querySelector(".block_messeng");const e=this.page.querySelector(".mess_btn");console.log(e),e.addEventListener("click",(()=>{const e=document.querySelector(".mess_text");console.log(e.value),this.field.addMessenge(this.pageMess,e.value,this.youName,this.youName,this.time()),this.websocket.send(JSON.stringify({type:"send",message:e.value,user:this.youName})),e.value=""}))}clearPage(e){e.innerHTML=""}time(){const e=new Date,t=e.getFullYear(),s=e.getMonth(),n=e.getDate();return` ${e.getHours()}:${e.getMinutes()} ${n}-${s+1}-${t}`}}).init()})();